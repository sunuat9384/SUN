<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3HK Shop Locations Map</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            background: #f0f0f0;
            font-family: "Microsoft JhengHei", "Noto Sans TC", sans-serif;
        }

        #map {
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Title Overlay specifically for PPT style */
        .title-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 5px solid #00A854; /* 3HK Green tone */
        }

        .title-overlay h1 {
            margin: 0;
            font-size: 24px;
            color: #333;
        }
        
        .title-overlay p {
            margin: 5px 0 0 0;
            font-size: 14px;
            color: #666;
        }

        /* Replay Button */
        #replay-btn {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            background: #00A854; /* 3HK Green tone */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background 0.3s;
        }

        #replay-btn:hover {
            background: #008f47;
        }

        /* The Pin Icon Styling */
        .custom-pin {
            background: transparent;
            border: none;
        }

        /* Falling Animation Keyframes */
        @keyframes dropIn {
            0% {
                opacity: 0;
                transform: translateY(-500px) scale(0.5);
            }
            60% {
                opacity: 1;
                transform: translateY(20px) scale(1.1);
            }
            80% {
                transform: translateY(-10px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .pin-icon-svg {
            filter: drop-shadow(3px 5px 2px rgba(0,0,0,0.4));
        }

    </style>
</head>
<body>

    <div class="title-overlay">
        <h1>3HK 門市分佈圖</h1>
        <p></p>
    </div>

    <div id="map"></div>
    <button id="replay-btn" onclick="startAnimation()">重播動畫 (Replay)</button>

    <script>
        // 1. Initialize Map
        // Centered on Hong Kong
        const map = L.map('map', {
            zoomControl: false, // Cleaner look for PPT
            attributionControl: false // Cleaner look
        }).setView([22.35, 114.14], 11);

        // Add a clean, Google-Maps-like tile layer (CartoDB Voyager)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            maxZoom: 19,
            subdomains: 'abcd',
        }).addTo(map);

        // 2. Data Preparation
        // Mapping district keywords to approximate coordinates (Lat, Lng)
        // Adding a small random jitter so pins in the same district don't overlap perfectly
        const locationMap = {
            "尖沙咀": [22.2980, 114.1730],
            "九龍灣": [22.3230, 114.2140],
            "上水": [22.5030, 114.1280],
            "大角咀": [22.3170, 114.1630], // 奥海城
            "大埔": [22.4508, 114.1642],
            "中環": [22.2825, 114.1570],
            "元朗": [22.4430, 114.0280],
            "天水圍": [22.4580, 114.0040],
            "太古城": [22.2810, 114.2230],
            "屯門": [22.3920, 113.9750],
            "北角": [22.2910, 114.2000],
            "佐敦": [22.3050, 114.1700],
            "大圍": [22.3730, 114.1780],
            "沙田": [22.3820, 114.1880],
            "旺角": [22.3193, 114.1694],
            "青衣城": [22.3580, 114.1070],
            "紅磡": [22.3050, 114.1860],
            "香港仔": [22.2480, 114.1540],
            "柴灣": [22.2640, 114.2370],
            "粉嶺": [22.4920, 114.1420],
            "荃灣": [22.3700, 114.1140],
            "馬鞍山": [22.4240, 114.2310],
            "將軍澳": [22.3080, 114.2600],
            "深水埗": [22.3300, 114.1610],
            "黃大仙": [22.3420, 114.1930],
            "葵芳": [22.3570, 114.1270],
            "銅鑼灣": [22.2800, 114.1850],
            "鰂魚涌": [22.2860, 114.2120],
            "灣仔": [22.2760, 114.1730],
            "觀塘": [22.3120, 114.2250],
            "鑽石山": [22.3400, 114.2020],
            "東涌": [22.2890, 113.9420]
        };

        const rawAddresses = [
            "九龍灣德福廣場平台P44號舖",
            "上水新都廣場2樓201A號舖",
            "大埔安慈路昌運中心地下24及25號舖",
            "中環德輔道中127號有餘貿易中心地下1號舖",
            "元朗康景街3-19號地下E號舖",
            "天水圍天華路 30 號 T Town 2 樓 S208 號舖",
            "屯門V city – M-9B 店鋪",
            "佐敦白加士街 42-50 號金寶樓地下1號舖",
            "沙田廣場3樓2A及2B號舖",
            "旺角西洋菜街南1A號百寶利商業中心地下3及4號舖",
            "旺角彌敦道750號始創中心地下G07號舖",
            "東涌富東邨富東商塲1樓120號舖",
            "荃灣眾安街68號千色匯一期二樓2054號鋪",
            "將軍澳重華路8號東港城2樓219A號舖",
            "將軍澳唐德街 9 號將軍澳中心商場 L1 層 109C 號舖",
            "深水埗福華街132-134號貴華樓地下B舖",
            "葵涌興芳路223號新都會廣塲1樓139B號舖",
            "觀塘創紀之城第五期 APM 5 樓 L5-1a 號舖"
        ];

        // Process data to get coordinates
        const shops = [];
        rawAddresses.forEach(addr => {
            let foundCoord = null;
            // Simple keyword matching
            for (const [key, coord] of Object.entries(locationMap)) {
                if (addr.includes(key)) {
                    // Add slight random jitter so markers don't stack exactly on top of each other
                    // about +/- 0.003 degrees (~300m)
                    const lat = coord[0] + (Math.random() - 0.5) * 0.008;
                    const lng = coord[1] + (Math.random() - 0.5) * 0.008;
                    foundCoord = [lat, lng];
                    break;
                }
            }
            if (foundCoord) {
                shops.push({ address: addr, lat: foundCoord[0], lng: foundCoord[1] });
            } else {
                // Default fallback center if detection fails 
                const lat = 22.3193 + (Math.random() - 0.5) * 0.1;
                const lng = 114.1694 + (Math.random() - 0.5) * 0.1;
                shops.push({ address: addr, lat: lat, lng: lng });
            }
        });

        // 3. Create Custom Green Pin Icon
        // Using an SVG string to ensure it's green and sharp
        const svgIcon = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#00A854" width="40" height="40" stroke="white" stroke-width="1.5">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
        `;

        const markers = [];

        function startAnimation() {
            // Clear existing markers
            markers.forEach(m => map.removeLayer(m));
            markers.length = 0;

            // Randomize order slightly for more natural "rain" effect
            const shuffledShops = [...shops].sort(() => 0.5 - Math.random());

            shuffledShops.forEach((shop, index) => {
                // Calculate delay: Fast drop (entire sequence in about 2-3 seconds)
                const delay = index * 80; // Adjusted delay for smoother effect

                const myIcon = L.divIcon({
                    className: 'custom-pin',
                    html: `<div class="pin-icon-svg" style="animation: dropIn 0.8s cubic-bezier(0.25, 1, 0.5, 1) forwards; animation-delay: ${delay}ms; opacity: 0; transform: translateY(-500px);">
                            ${svgIcon}
                           </div>`,
                    iconSize: [40, 40],
                    iconAnchor: [20, 40], // Tip of the pin
                    popupAnchor: [0, -40]
                });

                const marker = L.marker([shop.lat, shop.lng], { icon: myIcon }).addTo(map);
                
                // Add Popup
                marker.bindPopup(`<b style="color:#00A854">3HK</b><br>${shop.address}`);
                
                markers.push(marker);
            });
        }

        // Start animation on load
        window.onload = () => {
            setTimeout(startAnimation, 500); // Small buffer to let tiles load
        };

    </script>
</body>
</html>