<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smartone 門市分佈圖</title>
    <!-- Leaflet CSS for map display -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            background: #f0f0f0;
            font-family: "Microsoft JhengHei", "Noto Sans TC", sans-serif;
        }

        #map {
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Title Overlay specifically for PPT style */
        .title-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 5px solid #E3000F; /* Smartone Red tone */
        }

        .title-overlay h1 {
            margin: 0;
            font-size: 24px;
            color: #333;
        }
        
        .title-overlay p {
            margin: 5px 0 0 0;
            font-size: 14px;
            color: #666;
        }

        /* Replay Button */
        #replay-btn {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            background: #E3000F; /* Smartone Red tone */
            color: white; 
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background 0.3s;
        }

        #replay-btn:hover {
            background: #C4000C; /* Slightly darker red for hover */
        }

        /* The Pin Icon Styling */
        .custom-pin {
            background: transparent;
            border: none;
        }

        /* Falling Animation Keyframes */
        @keyframes dropIn {
            0% {
                opacity: 0;
                transform: translateY(-500px) scale(0.5);
            }
            60% {
                opacity: 1;
                transform: translateY(20px) scale(1.1);
            }
            80% {
                transform: translateY(-10px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .pin-icon-svg {
            filter: drop-shadow(3px 5px 2px rgba(0,0,0,0.4));
        }

    </style>
</head>
<body>

    <div class="title-overlay">
        <h1>Smartone 門市分佈圖</h1>
        <p></p>
    </div>

    <div id="map"></div>
    <button id="replay-btn" onclick="startAnimation()">重播動畫 (Replay)</button>

    <script>
        // 1. Initialize Map
        // Centered on Hong Kong
        const map = L.map('map', {
            zoomControl: false, // Cleaner look for PPT
            attributionControl: false // Cleaner look
        }).setView([22.35, 114.14], 11);

        // Add a clean, Google-Maps-like tile layer (CartoDB Voyager)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            maxZoom: 19,
            subdomains: 'abcd',
        }).addTo(map);

        // 2. Data Preparation
        // Mapping district keywords to approximate coordinates (Lat, Lng)
        const locationMap = {
            // HK Island
            "中環": [22.2825, 114.1570],
            "灣仔": [22.2760, 114.1730],
            "銅鑼灣": [22.2800, 114.1850],
            "北角": [22.2910, 114.2000],
            "柴灣": [22.2640, 114.2370],
            "香港仔": [22.2480, 114.1540],
            "太古城": [22.2810, 114.2230],

            // Kowloon
            "佐敦": [22.3050, 114.1700],
            "旺角": [22.3193, 114.1694],
            "深水埗": [22.3300, 114.1610],
            "紅磡": [22.3050, 114.1860],
            "黃大仙": [22.3420, 114.1930],
            "鑽石山": [22.3400, 114.2020],
            "九龍灣": [22.3230, 114.2140],
            "觀塘": [22.3120, 114.2250],

            // New Territories
            "沙田": [22.3820, 114.1880],
            "大圍": [22.3730, 114.1780],
            "馬鞍山": [22.4240, 114.2310],
            "大埔": [22.4508, 114.1642],
            "上水": [22.5030, 114.1280],
            "元朗": [22.4430, 114.0280],
            "屯門": [22.3920, 113.9750],
            "天水圍": [22.4580, 114.0040],
            "荃灣": [22.3700, 114.1140],
            "葵芳": [22.3570, 114.1270],
            "將軍澳": [22.3080, 114.2600]
        };

        const rawAddresses = [
            "九龍灣德福廣場一期P49-50號舖",
            "上水新都廣場254舖",
            "大埔超級城A區1樓17A舖",
            "中環港景街1號國際金融中心商場一期1樓1021號舖",
            "中環德輔道中127-131號有餘貿易中心地下2號舖",
            "元朗青山公路元朗段123號開心廣場地下3號舖",
            "元朗朗日路8號形點II 3樓A313c號舖",
            "元朗教育路26-34號百宜樓地下A鋪",
            "天水圍天耀廣場地下L054舖",
            "太古城道18 號 ,太古城中心1樓151A號舖",
            "屯門V CITY MTR層M-16號舖",
            "屯門屯門市廣場一期地下G129鋪",
            "佐敦佐敦道24A-26號金誠大廈地下C舖",
            "沙田大圍車公廟路18號圍方5樓511號舖",
            "沙田新城市廣場一期6樓615A舖",
            "旺角西洋菜街南1A百寶利商業中心地下5-7號舖",
            "炮台山怡安中心地下G19號舖",
            "紅磡德民街36-60F祈富大廈地下7A號舖",
            "香港仔成都道38號利港中心地下26-27號舖",
            "柴灣新翠商場第一層116舖",
            "荃灣大壩街4-30號荃灣廣場4樓429舖",
            "荃灣眾安街68 號荃灣千色匯一期2樓2046號舖",
            "馬鞍山新港城中心3樓3212號舖",
            "將軍澳中心一樓103-105號舖",
            "將軍澳重華路8號東港城2樓219號舖",
            "深水埗長沙灣道226-242號金華大廈A2舖",
            "葵芳新都會廣場1樓138號舖",
            "銅鑼灣怡和街46-54號麥當奴大廈地下G2舖",
            "灣仔莊士敦道181號大有廣場地下G3號鋪",
            "觀塘創紀之城五 期(APM)大堂高層UC-29號舖",
            "鑽石山荷里活廣場2樓247號舖"
        ];

        // Process data to get coordinates
        const shops = [];
        rawAddresses.forEach(addr => {
            let foundCoord = null;
            let matchedKey = null;

            // Simple keyword matching, prioritizing the most specific match found first
            const keys = Object.keys(locationMap);
            for (let i = 0; i < keys.length; i++) {
                const key = keys[i];
                if (addr.includes(key)) {
                    matchedKey = key;
                    break; 
                }
            }

            if (matchedKey) {
                const coord = locationMap[matchedKey];
                // Add slight random jitter so markers don't stack exactly on top of each other
                // about +/- 0.008 degrees
                const lat = coord[0] + (Math.random() - 0.5) * 0.008;
                const lng = coord[1] + (Math.random() - 0.5) * 0.008;
                foundCoord = [lat, lng];
            }
             
            if (foundCoord) {
                shops.push({ address: addr, lat: foundCoord[0], lng: foundCoord[1] });
            } else {
                // Fallback center if detection fails
                const lat = 22.3193 + (Math.random() - 0.5) * 0.1;
                const lng = 114.1694 + (Math.random() - 0.5) * 0.1;
                shops.push({ address: addr, lat: lat, lng: lng });
            }
        });

        // 3. Create Custom Red Pin Icon
        // Using an SVG string to ensure it's red and sharp
        const SMARTONE_RED = "#E3000F"; // Smartone's red

        const svgIcon = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="${SMARTONE_RED}" width="40" height="40" stroke="white" stroke-width="1.5">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
        `;

        const markers = [];

        function startAnimation() {
            // Clear existing markers
            markers.forEach(m => map.removeLayer(m));
            markers.length = 0;

            // Randomize order slightly for more natural "rain" effect
            const shuffledShops = [...shops].sort(() => 0.5 - Math.random());

            shuffledShops.forEach((shop, index) => {
                // Calculate delay: Fast drop (entire sequence in about 5 seconds)
                const delay = index * 70; 

                const myIcon = L.divIcon({
                    className: 'custom-pin',
                    html: `<div class="pin-icon-svg" style="animation: dropIn 0.8s cubic-bezier(0.25, 1, 0.5, 1) forwards; animation-delay: ${delay}ms; opacity: 0; transform: translateY(-500px);">
                            ${svgIcon}
                           </div>`,
                    iconSize: [40, 40],
                    iconAnchor: [20, 40], // Tip of the pin
                    popupAnchor: [0, -40]
                });

                const marker = L.marker([shop.lat, shop.lng], { icon: myIcon }).addTo(map);
                
                // Add Popup
                marker.bindPopup(`<b style="color:${SMARTONE_RED};">Smartone</b><br>${shop.address}`);
                
                markers.push(marker);
            });
        }

        // Start animation on load
        window.onload = () => {
            setTimeout(startAnimation, 500); // Small buffer to let tiles load
        };

    </script>
</body>
</html>